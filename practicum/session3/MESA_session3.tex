\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}

\pagenumbering{arabic}
\usepackage[margin=1.0in]{geometry}
\usepackage{natbib} 
\usepackage{hyperref}
\usepackage{enumitem}
\usepackage{xcolor}  % for coloring

\newcommand{\todo}[1]{\textbf{\textcolor{red}{#1}}}

% For pretty code blocks
\usepackage{listings}
% Bash style 
\definecolor{bgdark}{rgb}{0.27,0.27,0.27}
\definecolor{lighttext}{rgb}{0.95,0.95,0.95}
\definecolor{bashgreen}{rgb}{0.5,1.0,0.5}
\definecolor{bashblue}{rgb}{0.5,0.8,1.0}
\definecolor{bashcomment}{rgb}{0.6,0.6,0.6}
\definecolor{bashstring}{rgb}{1.0,0.6,0.6}
\lstset{
  language=bash,
  basicstyle=\ttfamily\small\color{lighttext},
  backgroundcolor=\color{bgdark},
  keywordstyle=\color{bashblue},
  commentstyle=\color{bashcomment},
  stringstyle=\color{bashstring},
  numbers=left,
  numberstyle=\tiny\color{bashcomment},
  stepnumber=1,
  frame=single,
  breaklines=true,
  showstringspaces=false
}
% Python style
\definecolor{pylightbg}{RGB}{250,250,250}
\definecolor{pyblue}{RGB}{0,0,180}      % keywords
\definecolor{pygreen}{RGB}{0,150,0}     % comments
\definecolor{pyred}{RGB}{180,0,0}       % strings
\definecolor{gray}{gray}{0.5}           % line numbers
\lstdefinestyle{pythonstyle}{
  language=Python,
  basicstyle=\ttfamily\small\color{black},
  backgroundcolor=\color{pylightbg},
  keywordstyle=\color{pyblue}\bfseries,
  commentstyle=\color{pygreen}\itshape,
  stringstyle=\color{pyred},
  numbers=left,
  numberstyle=\tiny\color{gray},
  stepnumber=1,
  frame=single,
  breaklines=true,
  showstringspaces=false
}


% For making the pro-tip boxes
\usepackage[most]{tcolorbox}
% define colors for the pro-tip boxes
\definecolor{protipbg}{HTML}{ebf0f2}    % 
\definecolor{protipborder}{HTML}{B0CAD4} % 
\definecolor{protiptext}{HTML}{003049}  % dark slate
\tcbset{
  protipbox/.style={
    colback=protipbg,
    colframe=protipborder,
    coltext=protiptext,
    fonttitle=\bfseries,
    title=Pro Tip,
    rounded corners,
    boxrule=0.pt,
    left=6pt,
    right=6pt,
    top=5pt,
    bottom=5pt
  }
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\title{
    \textbf{\texttt{MESA} tutorial:  Session 3} \\
    \textbf{\Large Late Evolution of Massive Stars}
}
\date{}
\maketitle
\vspace{-1cm}

For this problem set, make a new copy of the \texttt{\$MESA\_DIR/star/work} 
directory and place \texttt{hw3\_inlist}, \texttt{history\_columns.list}, and \texttt{profile\_columns.list} in your new working directory.
In the \texttt{inlist} file, change \texttt{inlist\_project} to \texttt{hw3\_inlist}...

\begin{tcolorbox}[protipbox]
Some of the models you will run in this practicum may take a long time to complete.
There is no need to wait for \textit{all} models to finish before starting on the analysis and plotting code!
\end{tcolorbox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Energy Production in Massive Stars}

Let's explore the contributions of various nuclear reaction chains to the bolometric luminosities of massive stars. 
% \todo{Rerun all with \texttt{delta\_HR\_limit = 0.003d0}, possibly think of ways to speed up
%  C exhaust takes very long (maybe turn off winds?). Double check all exercises work with same inlist}

\begin{itemize}
    \item Run MESA models at $M = 15, 20, 30, 40, 60 M_\odot$ through central C exhaustion.
    To achieve this add to the \texttt{\&controls} section in \texttt{hw3\_inlist}
        \begin{lstlisting}
    xa_central_lower_limit_species(1) = 'c12'
    xa_central_lower_limit(1) = 1d-5
        \end{lstlisting}
    
    Note the setting \texttt{log\_directory = 'M15\_HW3'}: will redirect your output to a new directory with this name, so you don't have to copy the whole work directory each time you want to run a new model.
    
\end{itemize}

\begin{enumerate}[label=(\alph*)]
    \item Plot the evolutionary tracks of all five stars on a single HR diagram. 
    Clip the pre-main sequence evolution from your plot for clarity.

    Color-code the tracks by the dominant source of nuclear burning. The three output quantities of interest are:
    \begin{itemize}
        \item \texttt{log\_LH}: H-burning luminosity
        \item \texttt{log\_LHe}: He-burning luminosity
        \item \texttt{log\_LZ}: Luminosity from burning heavier elements
        \item \todo{add neutrino luminosity..!}
    \end{itemize}
    \item Explore different ways of visualizing this data:
    \begin{itemize}[label=--]
        \item Create three panels, each color-coded by $\log (L_i/L_{\text{bol}})$ where $i = $ H, He, Z.
        \item Assign unique colors based on which burning source dominates the luminosity, and color the tracks accordingly.
        \item Identify and mark regions where no single source dominates the total luminosity.
    \end{itemize}

    \item Interpret your results. 

\end{enumerate}



\begin{tcolorbox}[protipbox]
You will be making a lot of HR diagrams in this practicum. Consider creating a reusable Python function to streamline the plotting process.
\end{tcolorbox}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Evolution of massive stars with mass loss}

In this exercise, we will investigate the effect of wind mass loss on the evolution of the star. 
We will use the same inlist as in Problem 1. As before, \emph{change the \texttt{log\_directory}} for each new model you evolve! (Otherwise the data from the previous models will be overwritten.)

\begin{enumerate}[label=(\alph*)]
\item Choose a mass between 20 M$_\odot$ and 100 M$_\odot$, and change the inlist. 
We only want to run the stars until core He exhaustion (this will save you a lot of compute time).
Run the same mass model with 3 different mass-loss rates. To do this vary the \verb|Dutch_scaling_factor| between 0 and 1, (for example 0.1, 0.5, and 1.0). 
During each run, take a close look at the \texttt{PGSTAR} plots. Analyse in detail both the motion of the star in the HR diagram and the changes in structure in the Kippenhahn diagram. Can you identify the different phases in the evolution of massive stars (e.g. RSG, LBV, WR, ...)? 

\item Plot all 3 evolutionary tracks on an HR diagram, but now color-code the tracks with mass-loss using $\log \dot{M}$ (e.g., range from $-6$ to $-4$).
Can you explain the difference in the tracks? 
Discuss with your neighbours to compare stars of different mass.

%%%%%%%%%% surf ab questions
\item Investigate surface abundance changes due to mass-loss. 
\begin{itemize}
    \item Plot surface abundances of He, C, and N versus time (all masses, one panel per element).
    \item Color-code HR tracks by:
    \begin{enumerate}
        \item Surface helium abundance
        \item Surface N/C ratio
    \end{enumerate}

\end{itemize}

\item Plot the He abundance versus age for all 3 models, and compare how the lifetimes of the MS and of the He-burning phase change with increasing mass loss.

\item Next, make separate plots of the \emph{surface abundances} of H, He, C and O vs age, one for each stellar model. Can you explain the changes you see, and their dependence on the mass-loss rate?
%%%%%%%%%% surf ab questions


\item Wolf–Rayet (WR) stars are generally defined by $X < 0.3$ (where $X$ is surface H abundance). WR subclasses are defined based on surface C and N composition (WN vs WC). Indicate where WR stars appear in the HR diagram.


\end{enumerate}

\begin{itemize}
\item After analysing the effects of mass loss, choose one of the models you evolved and continue its evolution, by removing the stopping condition for the lower limit of the central helium abundance. 
% This is already a sub panel in the grid in inlist_pgstar
% Open a \texttt{PGSTAR} window for the abundance profiles by adding the appropriate line in \verb|inlist_pgstar|, as in \texttt{MESA} session 1. 
Now follow the evolution and try to identify the different burning stages in the star and their effect on the abundances and the structure. 

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Radius evolution of massive stars}

% This exercise is a continuation on the second exercise of the previous exercise. In the last session, you evolved a massive star between 15 and 100 M$_\odot$ up to the end of core helium burning. Use the output of this model (stored in \verb|LOGS/history.data|) and compute the following:
Using your model for the star you picked with a mass between 15 and 100 M$_\odot$ from the previous exercise (with \verb|Dutch_scaling_factor| set to 1.0.) compute the following:

\begin{enumerate}[label=(\alph*)]
\item Make a plot of the radius of the star versus the age. What are the fast and slow phases of evolution? When does the star expand, and when does it contract? By how much does the star expand during its evolution?
\item If the star is in a binary system, in which phase in its evolution is it most likely that the star fills its Roche lobe?\\
\textit{Note}: Observations show that the distribution of the orbits of binary stars is roughly uniform in $\log(a)$. For example, the number of binary stars with separations in the range 10--100 R$_\odot$ is similar to that in the range 100--1000 R$_\odot$.
\item Find the values of the radius of this star that delimit Case A, Case B and Case C of mass transfer. (See p.\ 225 in Chapter 15 of the lecture notes for a definition of these different cases.)
%\item Find the radius of star at (\textit{i}) the ZAMS, (\textit{ii}) the TAMS, (\textit{iii}) the maximum radius before central helium ignition, (\textit{iv}) the maximum radius before the end of the evolution run but after central helium ignition.
\end{enumerate}


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Stellar Winds}

% Mass-loss plays a critical role in the late evolution of massive stars. This problem focuses on the effects of including stellar winds in your MESA models.

% \begin{itemize}[leftmargin=1.5em]
%     \item Use the same models as in Problem 1, but re-run them with the Dutch mass-loss scheme by setting:
    
%     \begin{lstlisting}
%     hot_wind_scheme = 'Dutch'
%     cool_wind_RGB_scheme = 'Dutch'
%     cool_wind_AGB_scheme = 'Dutch'
%     \end{lstlisting}

%     \item Analyze the following:
%     \begin{enumerate}[label=(\alph*)]
%         \item Compare HR tracks with and without mass-loss (one panel per mass). Color-code the tracks with mass-loss using $\log \dot{M}$ (e.g., range from $-6$ to $-4$).
        
%         Describe how the tracks differ as a function of stellar mass. Is there a threshold mass above which mass-loss effects qualitatively change the evolutionary path?

%         \item Investigate surface abundance changes due to mass-loss. 
%         \begin{itemize}
%             \item Plot surface abundances of He, C, and N versus time (all masses, one panel per element).
%             \item Color-code HR tracks by:
%             \begin{enumerate}
%                 \item Surface helium abundance
%                 \item Surface N/C ratio
%             \end{enumerate}
%             \item Wolf–Rayet (WR) stars are generally defined by $X < 0.3$ (where $X$ is surface H abundance). WR subclasses are defined based on surface C and N composition (WN vs WC). Indicate where WR stars appear in the HR diagram.
%         \end{itemize}
%     \end{enumerate}
% \end{itemize}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Population III stars}

% \begin{enumerate}
%   \setcounter{enumi}{1}
%   \item We’re now going to consider the effect of the CNO cycle on the structure of a $5M_{\odot}$ star. Recall from class that stars above $> 2M_{\odot}$ undergo H burning via the CNO cycle, whereas lower mass stars undergo H burning via the pp chain. 

%   You’ve already computed a ``standard'' $5M_{\odot}$ model in Problem 1, so now lets explore a few modifications (make sure that you reset the stopping conditions to be the same as in Problem 1). First, compute a model in which the metallicity is $Z=0.0$ (set \texttt{initial\_z=0.0}). There will be no CNO elements in the star, so it must undergo pp chain H burning.

%   Next, lets keep the metallicity at the default value ($Z=0.02$) and simply turn off the CNO reaction networks in \texttt{MESA}, thereby forcing the star to undergo pp chain reactions. This experiment provides a more direct test of the effect of CNO cycle vs.\ pp chain burning because the opacities, mean molecular weight, etc.\ remain the same. To do this, copy over \verb|\$MESA_DIR/data/net_data/nets/basic.net| to your work directory, name it \texttt{basic\_no\_cno.net}, comment out the four cno reactions (with \texttt{!} as the comment character), and point your inlist to the new file (using the \texttt{new\_net\_name} variable).

%   \begin{enumerate}
%     \item For these three models, plot \texttt{gradr\_sub\_grada} vs.\ $m/M$ for the models at the stopping criterion (the last one printed to file). This quantity is $> 0.0$ in regions where the star is convectively unstable. What do you notice? Next, plot $\log T$ vs.\ $\log \rho$ profiles for these three models. Comment on what you observe. Why does CNO burning produce such a different core structure compared to pp burning?

%     \item Next, plot the evolution in $L-T_{\mathrm{eff}}$. Comment on what you see. Why are the differences more pronounced between the default model and the $Z=0.0$ model, compared to the model in which CNO burning is turned off? Consider the other effects that the composition has besides the nuclear reaction rates. 
%   \end{enumerate}
% \end{enumerate}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%








% \bibliographystyle{aa}
% \bibliography{gmlib.bib}

\end{document}
